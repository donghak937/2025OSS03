<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Game Review Site</title>

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
        <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
        <style>
            #list_block{
                background-color: aqua;
                border: solid 5px black;
                border-radius: 5px;
                padding: 5px;
            }
            .btn {
                margin-bottom: 10px;
            }
        </style>
    </head>
    <body>
        <h1>AJAX Practice CRUD SITE</h1>

        <button id="view_btn" class="btn btn-primary">View List</button> <br>
        <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addModal">Add Game</button>
        <button class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#editModal">Edit Game</button>
        <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteModal">Delete Game</button> <br>
        <br><br>

        <div id="game_list"></div>

        <div class="modal fade" id="addModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5">Add Game</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <div class="modal-body">
                    <div class="mb-3">
                        <label for="add_username_input" class="form-label">username</label>
                        <input type="text" class="form-control" id="add_username_input">
                    </div>

                    <div class="mb-3">
                        <label for="add_gamename_input" class="form-label">gamename</label>
                        <input type="text" class="form-control" id="add_gamename_input">
                    </div>

                    <div class="mb-3">
                        <label for="add_rating_input" class="form-label">rating</label>
                        <input type="number" class="form-control" id="add_rating_input">
                    </div>

                    <div class="mb-3">
                        <label for="add_description_input" class="form-label">description</label>
                        <input type="text" class="form-control" id="add_description_input">
                    </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="add_confirm_btn">Add</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="editModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5">Edit Game</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <div class="modal-body">
                    <div class="mb-3">
                        <label for="edit_id_input" class="form-label">id</label>
                        <input type="text" class="form-control" id="edit_id_input">
                    </div>

                    <div class="mb-3">
                        <label for="edit_username_input" class="form-label">username</label>
                        <input type="text" class="form-control" id="edit_username_input">
                    </div>

                    <div class="mb-3">
                        <label for="edit_gamename_input" class="form-label">gamename</label>
                        <input type="text" class="form-control" id="edit_gamename_input">
                    </div>

                    <div class="mb-3">
                        <label for="edit_rating_input" class="form-label">rating</label>
                        <input type="number" class="form-control" id="edit_rating_input">
                    </div>

                    <div class="mb-3">
                        <label for="edit_description_input" class="form-label">description</label>
                        <input type="text" class="form-control" id="edit_description_input">
                    </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="edit_confirm_btn">Edit</button>
                    </div>
                </div>
            </div>
        </div>


        <div class="modal fade" id="deleteModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5">Delete Game</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <div class="modal-body">
                    <div class="mb-3">
                        <label for="del_id_input" class="form-label">id</label>
                        <input type="text" class="form-control" id="del_id_input">
                    </div>
                </div>
                <div class="modal-footer">
                        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-danger" id="del_confirm_btn">Delete</button>
                </div>
            </div>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

        <script>
            $("#view_btn").click(function(){
                alert("Games Loaded");

                const xhr = new XMLHttpRequest();
                xhr.open("GET","https://68dde703d7b591b4b78dd59c.mockapi.io/games");
                xhr.setRequestHeader("content-type","application/json");
                xhr.send();
                xhr.onload = () => {
                    if (xhr.status === 200) {
                        let res = JSON.parse(xhr.response);
                        $("#div_list").html("");
                        res.forEach(function(each){
                            $("#game_list").append(`<div id = "list_block"> id of game : ${each.id} <br> username : ${each.username}
                                <br> game name : ${each.game_name} <br> rating : ${each.rating} <br> description : ${each.description} </div> <br> `);
                        });
                    } else {
                        console.log(xhr.status, xhr.statusText);
                    }
                }
            });
            $("#add_confirm_btn").click(function(){
                alert("Game added");

                const xhr = new XMLHttpRequest();
                xhr.open("POST","https://68dde703d7b591b4b78dd59c.mockapi.io/games");
                xhr.setRequestHeader("content-type","application/json");
                let data = {username: $("#add_username_input").val(), game_name: $("#add_gamename_input").val(), rating: $("#add_rating_input").val(), description: $("#add_description_input").val() };
                xhr.send(JSON.stringify(data));
                xhr.onload = () => {
                    if (xhr.status === 200) {
                        let res = JSON.parse(xhr.response);
                        alert(JSON.stringify(res));
                    } else {
                        console.log(xhr.status, xhr.statusText);
                    }
                }
            });
            $("#del_confirm_btn").click(function(){
                const xhr = new XMLHttpRequest();
                
                xhr.open("DELETE","https://68dde703d7b591b4b78dd59c.mockapi.io/games/" + $("#del_id_input").val());
                xhr.setRequestHeader("content-type","application/json");
                xhr.send();
                
                xhr.onload = () => {
                    if (xhr.status === 200) {
                        let res = JSON.parse(xhr.responseText);
                        const name = res.game_name;
                        alert("Game \"" + name + "\" deleted");
                        
                    } else {
                        alert("Failed");
                    }
                }
            });
            $("#edit_confirm_btn").click(function(){
                const xhr = new XMLHttpRequest();
                xhr.open("PUT","https://68dde703d7b591b4b78dd59c.mockapi.io/games/" + $("#edit_id_input").val());
                xhr.setRequestHeader("content-type","application/json");
                let data = { id: $("#edit_id_input").val(), username: $("#edit_username_input").val(), game_name: $("#edit_gamename_input").val(), rating: $("#edit_rating_input").val(), description: $("#edit_description_input").val() };
                xhr.send(JSON.stringify(data));
                xhr.onload = () => {
                    if (xhr.status === 200) {
                        let res = JSON.parse(xhr.response);
                        alert("Edited");
                    } else {
                        alert("Failed");
                    }
                }
            });
        </script>
    </body>
</html>